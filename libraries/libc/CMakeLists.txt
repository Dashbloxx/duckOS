SET(SOURCES
        crt0.c
        assert.c
        stdio.c
)

# Install crt0.o
ADD_LIBRARY(crt0 STATIC crt0.c)
INSTALL(TARGETS crt0 LIBRARY DESTINATION usr/lib)
ADD_CUSTOM_COMMAND(TARGET crt0 COMMAND install -D $<TARGET_OBJECTS:crt0> ${CMAKE_INSTALL_PREFIX}/usr/lib/crt0.o)

# Install libc
ADD_LIBRARY(libc ${SOURCES})
INSTALL(TARGETS libc LIBRARY DESTINATION usr/lib)
SET_TARGET_PROPERTIES(libc PROPERTIES PREFIX "")
TARGET_LINK_DIRECTORIES(libc PUBLIC ${CMAKE_CURRENT_BINARY_DIR})
TARGET_LINK_LIBRARIES(libc crt0)
ADD_CUSTOM_COMMAND(TARGET libc COMMAND install -D $<TARGET_FILE:libc> ${CMAKE_INSTALL_PREFIX}/usr/lib/libc.so)

# Install headers
FILE(GLOB_RECURSE LIBHEADERS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "*.h")
foreach(HEADER ${LIBHEADERS})
    GET_FILENAME_COMPONENT(SUBDIRECTORY ${HEADER} DIRECTORY)
    install(FILES ${HEADER} DESTINATION usr/include)
endforeach()