# duckOS Build / Run instructions

## Prerequisites

### Dependencies
- A Linux environment (WSL will work, but WSL2 is preferred because it is much faster than WSL1)
- GCC
- Nasm
- Make
- CMake
- Bison
- Flex
- GMP
- MPFR
- MPC
- Texinfo
- Grub
- Gawk
- QEmu (For emulating)

### Installing dependencies
- Ubuntu/Debian: `apt install build-essential cmake bison flex libgmp3-dev libmpc-dev libmpfr-dev texinfo qemu-system-i386 qemu-utils nasm gawk grub2-common grub-pc`
- Arch: `pacman -S base-devel cmake gmp libmpc mpfr qemu qemu-arch-extra nasm grub`

## Building the toolchain
1. Open the `toolchain` directory in your terminal and run `build-toolchain.sh`. (You will need an internet connection as it downloads the needed binutils/gcc releases from the GNU ftp site and newlib from the newlib ftp site.)
2. Make a cup of coffee or tea and wait. It will take a while to compile.

### Editing the toolchain
If you'd like to edit the toolchain, you can run the `edit-toolchain.sh` script to download patch binutils/gcc/newlib and setup a git repository for each one. Then, use the `gen-patches.sh` script to generate patch files for each one.

**DO NOT** git commit in the repositories created by `edit-toolchain` or else `gen-patches` won't work properly.

To build something from the `edit` directory, pass the `edited-[thing]` to the `build-toolchain.sh` script. (ex: `build-toolchain.sh edited-newlib` to build newlib from the edit directory)

## Configuring cmake
1. Make sure you've built the toolchain first.
2. Make a build folder somewhere outside of this project where you'd like to build the kernel.
3. From that directory, run `cmake duckos_dir`, substituting `duckos_dir` for the directory in which the duckOS repository is located on your computer.

## Building and running duckOS
1. In your build directory, run `make` and then `make install` to build the kernel & programs.
2. Run `sudo make image` to make the root filesystem image. (This must be run as root)
3. Run `sudo chown -R username:username .` substituting `username` for your username to take ownership of the files generated by the previous step (this only needs to be done the first time)
4. Run `make qemu-image` to run qemu with the image you just made.
5. Enjoy!
